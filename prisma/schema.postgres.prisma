// Prisma schema for Corporate CMS
// PostgreSQL for production (Vercel)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== ENUMS ====================

enum Role {
  USER
  ADMIN
  SUPER_ADMIN
}

enum MenuLocation {
  HEADER
  FOOTER
  BOTH
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum EntityType {
  ARTICLE
  RESOURCE
  REALISATION
  EVENT
}

// ==================== USER & AUTH ====================

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String?
  avatar        String?
  role          Role      @default(USER)
  active        Boolean   @default(true)
  emailVerified DateTime?
  lastLogin     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?

  // Relations
  articles         Article[]
  uploadedMedia   MediaAsset[]
  contactMessages ContactMessage[]
  approvalRequests Approval[]  @relation("ApprovalRequester")
  approvalReviews  Approval[]  @relation("ApprovalReviewer")

  @@index([email])
  @@index([role])
  @@index([deletedAt])
}

// ==================== SITE SETTINGS ====================

model SiteSettings {
  id              String  @id @default("site-settings")

  // Logo
  logoUrl         String?
  logoAltFr       String?
  logoAltEn       String?

  // Colors (HEX format)
  color1          String  @default("#362981") // Violet principal
  color2          String  @default("#009446") // Vert principal
  color3          String  @default("#029CB1") // Teal
  color4          String  @default("#9AD2E2") // Bleu clair

  // Site info
  siteNameFr      String  @default("AAEA")
  siteNameEn      String  @default("AAEA")
  siteDescriptionFr String?
  siteDescriptionEn String?

  // Contact info
  address         String?
  email           String?
  phone           String?
  phone2          String?
  workingHoursFr  String?
  workingHoursEn  String?

  // Social links (JSON)
  socialLinks     String? // JSON string: {facebook, twitter, linkedin, instagram, youtube}

  // Google Maps
  mapLatitude     Float?
  mapLongitude    Float?
  mapZoom         Int     @default(15)
  mapApiKey       String?

  // SEO
  metaTitleFr     String?
  metaTitleEn     String?
  metaDescriptionFr String?
  metaDescriptionEn String?
  metaKeywords    String?

  // Analytics
  googleAnalyticsId String?
  googleTagManagerId String?

  // Pagination settings
  articlesPerPage       Int     @default(10)
  realisationsPerPage   Int     @default(9)
  resourcesPerPage      Int     @default(12)
  eventsPerPage         Int     @default(6)

  updatedAt       DateTime @updatedAt
}

// ==================== MENUS ====================

model MenuItem {
  id          String      @id @default(cuid())
  parentId    String?
  order       Int         @default(0)
  slug        String
  route       String
  labelFr     String
  labelEn     String
  visible     Boolean     @default(true)
  location    MenuLocation @default(HEADER)
  icon        String?
  external    Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  deletedAt   DateTime?

  // Self-relation for nested menus
  parent      MenuItem?   @relation("MenuHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    MenuItem[]  @relation("MenuHierarchy")

  @@index([slug])
  @@index([parentId])
  @@index([location])
  @@index([order])
  @@index([deletedAt])
}

// ==================== PAGES ====================

model Page {
  id              String    @id @default(cuid())
  parentId        String?
  slug            String    @unique
  titleFr         String
  titleEn         String
  contentFr       String?   // Rich text/HTML
  contentEn       String?
  metaTitleFr     String?
  metaTitleEn     String?
  metaDescriptionFr String?
  metaDescriptionEn String?
  published       Boolean   @default(false)
  order           Int       @default(0)
  showInMenu      Boolean   @default(false)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  deletedAt       DateTime?

  // Self-relation for sub-pages
  parent          Page?     @relation("PageHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children        Page[]    @relation("PageHierarchy")

  @@index([slug])
  @@index([parentId])
  @@index([published])
  @@index([deletedAt])
}

// ==================== HOMEPAGE SECTIONS ====================

model Slider {
  id            String    @id @default(cuid())
  titleFr       String
  titleEn       String
  subtitleFr    String?
  subtitleEn    String?
  buttonTextFr  String?
  buttonTextEn  String?
  buttonUrl     String?
  imageUrl      String
  imageAltFr    String?
  imageAltEn    String?
  order         Int       @default(0)
  visible       Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?

  @@index([order])
  @@index([visible])
  @@index([deletedAt])
}

model HomeAbout {
  id          String    @id @default("home-about")
  titleFr     String
  titleEn     String
  contentFr   String    // Rich text
  contentEn   String
  imageUrl    String?
  imageAltFr  String?
  imageAltEn  String?
  buttonTextFr String?
  buttonTextEn String?
  buttonUrl   String?
  updatedAt   DateTime  @updatedAt
}

model Service {
  id            String    @id @default(cuid())
  titleFr       String
  titleEn       String
  descriptionFr String?
  descriptionEn String?
  icon          String?   // Lucide icon name
  imageUrl      String?
  imageAltFr    String?
  imageAltEn    String?
  order         Int       @default(0)
  visible       Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?

  @@index([order])
  @@index([visible])
  @@index([deletedAt])
}

model Testimonial {
  id          String    @id @default(cuid())
  name        String
  company     String?
  textFr      String
  textEn      String
  avatar      String?
  rating      Int       @default(5)
  order       Int       @default(0)
  visible     Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?

  @@index([order])
  @@index([visible])
  @@index([deletedAt])
}

model Partner {
  id          String    @id @default(cuid())
  name        String
  logoUrl     String
  website     String?
  order       Int       @default(0)
  visible     Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?

  @@index([order])
  @@index([visible])
  @@index([deletedAt])
}

model HomeCTA {
  id          String    @id @default("home-cta")
  titleFr     String
  titleEn     String
  subtitleFr  String?
  subtitleEn  String?
  buttonTextFr String?
  buttonTextEn String?
  buttonUrl   String?
  updatedAt   DateTime  @updatedAt
}

// ==================== REALISATIONS (PORTFOLIO) ====================

model RealisationCategory {
  id          String        @id @default(cuid())
  nameFr      String
  nameEn      String
  slug        String        @unique
  descriptionFr String?
  descriptionEn String?
  order       Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  deletedAt   DateTime?

  realisations Realisation[]

  @@index([slug])
  @@index([order])
  @@index([deletedAt])
}

model Realisation {
  id            String              @id @default(cuid())
  titleFr       String
  titleEn       String
  descriptionFr String?
  descriptionEn String?
  client        String?
  date          DateTime?
  location      String?
  imageUrl      String?
  gallery       String?             // JSON array of image URLs
  published     Boolean             @default(false)
  featured      Boolean             @default(false)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  deletedAt     DateTime?

  categoryId    String?
  category      RealisationCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([published])
  @@index([featured])
  @@index([categoryId])
  @@index([deletedAt])
}

// ==================== RESOURCES ====================

model ResourceCategory {
  id          String      @id @default(cuid())
  nameFr      String
  nameEn      String
  slug        String      @unique
  descriptionFr String?
  descriptionEn String?
  order       Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  deletedAt   DateTime?

  resources   Resource[]

  @@index([slug])
  @@index([order])
  @@index([deletedAt])
}

model Resource {
  id            String            @id @default(cuid())
  titleFr       String
  titleEn       String
  descriptionFr String?
  descriptionEn String?
  fileUrl       String
  fileType      String            // MIME type
  fileSize      Int               // Bytes
  fileName      String
  published     Boolean           @default(false)
  downloadCount Int               @default(0)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  deletedAt     DateTime?

  categoryId    String?
  category      ResourceCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([published])
  @@index([categoryId])
  @@index([deletedAt])
}

// ==================== EVENTS ====================

model Event {
  id            String    @id @default(cuid())
  titleFr       String
  titleEn       String
  descriptionFr String?
  descriptionEn String?
  date          DateTime
  endDate       DateTime?
  location      String?
  imageUrl      String?
  imageAltFr    String?
  imageAltEn    String?
  gallery       String?   // JSON array of photo URLs
  videos        String?   // JSON array of YouTube URLs
  published     Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?

  @@index([date])
  @@index([published])
  @@index([deletedAt])
}

// ==================== ARTICLES (BLOG) ====================

model ArticleCategory {
  id          String      @id @default(cuid())
  nameFr      String
  nameEn      String
  slug        String      @unique
  descriptionFr String?
  descriptionEn String?
  order       Int         @default(0)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  deletedAt   DateTime?

  articles    Article[]

  @@index([slug])
  @@index([order])
  @@index([deletedAt])
}

model Article {
  id            String            @id @default(cuid())
  titleFr       String
  titleEn       String
  slug          String            @unique
  contentFr     String            // Rich text/HTML
  contentEn     String
  excerptFr     String?
  excerptEn     String?
  imageUrl      String?
  imageAltFr    String?
  imageAltEn    String?
  published     Boolean           @default(false)
  featured      Boolean           @default(false)
  publishedAt   DateTime?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  deletedAt     DateTime?

  authorId      String
  author        User              @relation(fields: [authorId], references: [id], onDelete: Cascade)

  categoryId    String?
  category      ArticleCategory?  @relation(fields: [categoryId], references: [id], onDelete: SetNull)

  @@index([slug])
  @@index([published])
  @@index([featured])
  @@index([publishedAt])
  @@index([authorId])
  @@index([categoryId])
  @@index([deletedAt])
}

// ==================== MEDIA ====================

model MediaAsset {
  id            String    @id @default(cuid())
  filename      String
  originalName  String
  url           String
  mimeType      String
  size          Int       // Bytes
  width         Int?
  height        Int?
  altFr         String?
  altEn         String?
  titleFr       String?
  titleEn       String?
  descriptionFr String?
  descriptionEn String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?

  uploadedById  String?
  uploadedBy    User?     @relation(fields: [uploadedById], references: [id], onDelete: SetNull)

  @@index([mimeType])
  @@index([uploadedById])
  @@index([deletedAt])
}

// ==================== CONTACT ====================

model ContactMessage {
  id          String    @id @default(cuid())
  name        String
  email       String
  phone       String?
  subject     String?
  message     String
  isRead      Boolean   @default(false)
  readAt      DateTime?
  replied     Boolean   @default(false)
  repliedAt   DateTime?
  replyMessage String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  repliedById String?
  repliedBy   User?     @relation(fields: [repliedById], references: [id], onDelete: SetNull)

  @@index([email])
  @@index([isRead])
  @@index([createdAt])
}

model ContactInfo {
  id          String    @id @default("contact-info")
  titleFr     String?
  titleEn     String?
  descriptionFr String?
  descriptionEn String?
  address     String?
  email       String?
  phone       String?
  phone2      String?
  workingHoursFr String?
  workingHoursEn String?
  mapEmbedUrl String?
  updatedAt   DateTime  @updatedAt
}

// ==================== APPROVALS WORKFLOW ====================

model Approval {
  id            String        @id @default(cuid())
  status        ApprovalStatus @default(PENDING)
  entityType    EntityType
  entityId      String
  comment       String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  reviewedAt    DateTime?

  requestedById String
  requestedBy   User          @relation("ApprovalRequester", fields: [requestedById], references: [id], onDelete: Cascade)

  reviewedById  String?
  reviewedBy    User?         @relation("ApprovalReviewer", fields: [reviewedById], references: [id], onDelete: SetNull)

  @@unique([entityType, entityId])
  @@index([status])
  @@index([entityType])
  @@index([requestedById])
  @@index([reviewedById])
}
